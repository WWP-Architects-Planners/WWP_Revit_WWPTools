<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package Name="WW+P Tools Dynamo Packages"
           Manufacturer="WW+P"
           Version="1.0.0.0"
           UpgradeCode="{9E2B4D73-3C4C-4A26-BB17-8E9E7D6BB2E3}"
           Scope="perUser"
           Compressed="yes">
    <Icon Id="WWPToolsIcon" SourceFile="WWPTools.ico" />
    <Property Id="ARPPRODUCTICON" Value="WWPToolsIcon" />
    <MajorUpgrade DowngradeErrorMessage="A newer version of WWPTools packages is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <StandardDirectory Id="AppDataFolder">
      <Directory Id="WWPToolsAppData" Name="WWPTools" />
    </StandardDirectory>
    <Component Id="RegistryMarker" Directory="WWPToolsAppData" Guid="*">
      <RegistryValue Root="HKCU"
                     Key="Software\WWP\WWPTools"
                     Name="PackagesInstalled"
                     Type="integer"
                     Value="1"
                     KeyPath="yes" />
    </Component>
    <Feature Id="MainFeature" Title="WWPTools Packages" Level="1">
      <ComponentRef Id="RegistryMarker" />
    </Feature>

    <Property Id="WIXUI_INSTALLDIR" Value="WWPToolsAppData" />
    <WixVariable Id="WixUILicenseRtf" Value="license.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="WWPTools-banner.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="WWPTools-dialog.png" />
    <UI>
      <ui:WixUI Id="WixUI_InstallDir" />
    </UI>

    <InstallUISequence>
      <Custom Action="SetWixQuietExecCmdLineInstall" Before="ExecuteAction" Condition="NOT REMOVE~=&quot;ALL&quot;" />
    </InstallUISequence>

    <Property Id="WixQuietExecCmdLine" Hidden="yes" />
    <CustomAction Id="SetWixQuietExecCmdLineInstall"
                  Property="WixQuietExecCmdLine"
                  Value="&quot;[SystemFolder]WindowsPowerShell\v1.0\powershell.exe&quot; -NoProfile -ExecutionPolicy Bypass -EncodedCommand __WWPTOOLS_PS_INSTALL_BASE64__" />
    <CustomAction Id="SetWixQuietExecCmdLineUninstall"
                  Property="WixQuietExecCmdLine"
                  Value="&quot;[SystemFolder]WindowsPowerShell\v1.0\powershell.exe&quot; -NoProfile -ExecutionPolicy Bypass -EncodedCommand __WWPTOOLS_PS_UNINSTALL_BASE64__" />
    <CustomActionRef Id="Wix4QuietExec_X64" />

    <InstallExecuteSequence>
      <Custom Action="SetWixQuietExecCmdLineInstall" Before="Wix4QuietExec_X64" Condition="NOT REMOVE~=&quot;ALL&quot;" />
      <Custom Action="SetWixQuietExecCmdLineUninstall" Before="Wix4QuietExec_X64" Condition="REMOVE~=&quot;ALL&quot;" />
      <Custom Action="Wix4QuietExec_X64" After="InstallInitialize" />
    </InstallExecuteSequence>
  </Package>
</Wix>
